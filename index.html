<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Breakout for your Browser">
    <meta name="author" content="Robert Heinemann">
    <meta name="keywords" content="Breakout, Games, Game, Classic, Retro, Retro Games">
    <title>Breakout JavaScript</title>
    <style>*{padding: 0; margin: 0} canvas{background: #eee; display: block; margin: 0}</style>
</head>

<body>
    <canvas id="myCanvas" width="480px" height="320px"></canvas>

    <script>
//-------------CANVAS--DRAW-METHOD-----------------------------------------//
        //draw canvas
        var cvs = document.getElementById("myCanvas");
        var ctx = cvs.getContext("2d");
//-------------------------------------------------------------------------//

//-------------PADDLE-VARIABLES-AND-DRAW-METHOD----------------------------//
        //paddle variables
        var PWIDTH = 75, PHEIGHT = 15, pPosX = (cvs.width-PWIDTH)/2, MOVESPEED = 5;
        //draw paddle
        function drawPaddle() {
            ctx.beginPath();
            //handle movement
            if ((rightPressed == true) && (pPosX + PWIDTH < cvs.width))  {
                pPosX += MOVESPEED;
            }
            if ((leftPressed == true) && (pPosX > 0))  {
                pPosX -= MOVESPEED;
            }
            ctx.rect(pPosX, cvs.height-PHEIGHT, PWIDTH, PHEIGHT);
            ctx.fillStyle = "blue";
            ctx.fill();
            ctx.closePath();
        }
//------------------------------------------------------------------------//

//-----------------------------PADDLE-CONTROLS----------------------------//
        var rightPressed = false, leftPressed = false;
        //if pressed, change pPos
        function keyDownHandler(k) {
            if (k.key == "Right" || k.key == "ArrowRight")  {
                rightPressed = true;
            }
            if (k.key == "Left" || k.key == "ArrowLeft")  {
                leftPressed = true;
            }
        }
        function keyUpHandler(k) {
            if(k.key == "Right" || k.key == "ArrowRight")  {
                rightPressed = false;
            }
            if(k.key == "Left" || k.key == "ArrowLeft")  {
                leftPressed = false;
            }
        }
//------------------------------------------------------------------------//

//-------------BALL-VARIABLES-AND-DRAW-METHOD-----------------------------//
        //ball variables: position, radius, speed/direction of movement
        var bPosX = cvs.width/2, bPosY = cvs.height-30, radius = 10, R = Math.PI*2, dX = 2, dY = -2;
        //draw ball
        function drawBall()  {
            //draw ball
            ctx.beginPath();
            ctx.arc(bPosX, bPosY, radius, 0, R, false);
            ctx.fillStyle = "green";
            ctx.fill();
            ctx.closePath();
            //update position
            bPosX+=dX;
            bPosY+=dY;
        }
//----------------------------------------------------------------------//

//-------------------------BRICK-VARIABLES------------------------------//
        //brick variables -> 2d array
        var row = 3, col = 5;
        var BWIDTH = 75, BHEIGHT = 20, BPADDING = 10, BOFFSETTOP = 30, BOFFSETLEFT = 30;
        //build brick array for storing the pos
        var brickwall = [];
        for (var i = 0; i < col; i++)  {
            brickwall[i] = [];
            for (var j = 0; j < row; j++)  {
                brickwall[i][j] = {brX: 0, brY: 0};
            }
        }

        //drawcall
        function drawBricks()  {
            for (var c = 0; c < col; c++)  {
                for (var r = 0; r < row; r++)  {
                    //positioning of bricks in relation to loop steps for 'wall' optic
                    var brickPosX = (c*(BWIDTH + BPADDING))+BOFFSETLEFT;
                    var brickPosY = (r*(BHEIGHT + BPADDING))+BOFFSETTOP;
                    //safe position for collision detection
                    brickwall[c][r].brX = brickPosX;
                    brickwall[c][r].brY = brickPosY;
                    //actually draw the bricks
                    ctx.beginPath();
                    ctx.rect(brickPosX, brickPosY, BWIDTH, BHEIGHT);
                    ctx.fillStyle = "#0095DD";
                    ctx.fill();
                    ctx.closePath();
                }
            }
        }
//----------------------------------------------------------------------//

//---------------------COLLISION-DETECTION------------------------------//
        //with canvas
        function collisionCanvas() {
            //right/left border
            if (bPosX + dX > cvs.width-radius || bPosX + dX < radius)  {
                dX = -dX;
            }
            //top border
            else if (bPosY + dY < radius)  {
                dY = -dY
            }
            //hit the floor - lose life and game over
            else if (bPosY + dY > cvs.height-radius) {
                lives--;
                //game over
                if (!lives)  {
                    alert("GAME OVER!");
                    document.location.reload();
                    clearInterval(interval);
                }
                //lose life
                else  {
                    alert("Ball dropped! Remaining Lives: " + lives);
                    bPosX = cvs.width/2; bPosY = cvs.height-30; dX = 2; dY=-2; pPosX = cvs.width/2;
                }
            }
        }
        //with paddle
        function collisionPaddle()  {
            if ((bPosY + dY > cvs.height-PHEIGHT) && (bPosX > pPosX && bPosX < pPosX + PWIDTH))
                dY = -dY;
        }
        //with bricks
        function collisionBricks() {

        }

        //collision call
        function collisionDetection() {
            collisionCanvas();
            collisionPaddle();
            //collisionBricks();
        }
//----------------------------------------------------------------------//

//---------------------GAME-LOGIC---------------------------------------//
        var score = 0, lives = 3;
//----------------------------------------------------------------------//

//---------------------DRAWING-LOOP-------------------------------------//
        var REFRESH = 10;   //time in ms to refresh the frames
        //drawing loop - call the single draw calls
        function drawLoop()  {
            //enable paddle control
            document.addEventListener("keydown", keyDownHandler, false);
            document.addEventListener("keyup", keyUpHandler, false);
            //clear context from previous movements (from min(x,y) -> to max(x,y))
            ctx.clearRect(0, 0, cvs.width, cvs.height);
            //draw calls
            collisionDetection();
            drawBall();
            drawPaddle();
            drawBricks();
        } var interval = setInterval(drawLoop, REFRESH);
//----------------------------------------------------------------------//

    </script>
</body>
</html>

